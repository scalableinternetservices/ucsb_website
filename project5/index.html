<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Scalable Internet Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>

  <body>

        <div class="container-fluid">
      <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Scalable Internet Services</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/schedule/">Class Schedule</a></li>
              <li class="active"><a href="/project1/">Project 1</a></li>
              <li class="active"><a href="/project2/">Project 2</a></li>
              <li class="active"><a href="/project3/">Project 3</a></li>
              <li class="active"><a href="/project4/">Project 4</a></li>
              <li class="active"><a href="/project5/">Project 5</a></li></ul>
          </div>
        </div>
      </div>
    </div>


    <div class="container container-left">
      <div class="row">
        <div class="col-md-3">
          <div class="sidebar">
  <h1 id="course-info">Course Info</h1>

<ul>
  <li>Course Number: CS291A</li>
  <li>Quarter: Fall 2025</li>
</ul>

<h2 id="instructor">Instructor</h2>

<ul>
  <li><a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a></li>
  <li><a href="mailto:zach_walker@ucsb.edu">email</a></li>
</ul>

<!-- ## UCSB TA

- TBD

## Appfolio TA

- Maximilian Medearis
- [email](mailto:maximilian.medearis@appfolio.com)


Please use [Piazza](https://piazza.com/ucsb/fall2025/cs291a) for class-related correspondance.
 -->

<h2 id="dates">Dates</h2>

<h3 id="classes">Classes</h3>

<ul>
  <li>Mon and Wed</li>
  <li>1:00pm â€“ 2:50am PT</li>
  <li>Phelps 2510</li>
</ul>

<h3 id="office-hours">Office Hours</h3>

<!-- - TBD

In-person

- Tuesday 8am -- 9am, Phelps 3526
- Thursday 8am -- 9am, Phelps 3526

Virtual

- Tuesday 4 -- 5pm, link in [Piazza](https://piazza.com/ucsb/fall2025/cs291a)
- Friday 4 -- 5pm, link in [Piazza](https://piazza.com/ucsb/fall2025/cs291a) -->

<h3 id="initial-tasks-due-before">Initial tasks due before</h3>

<p>Wednesday, Oct 1 12pm PT</p>

<ul>
  <li>Complete the <a href="https://forms.gle/TyxFWZnkW9qaqBhE7">introduction survey</a></li>
  <li>Join the class on <a href="https://piazza.com/ucsb/fall2025/cs291a">Piazza</a></li>
</ul>

<!-- - Enroll in [AWS Educate](https://www.awseducate.com/Registration?apptype=student&courseview=true) -->

<h3 id="project-1project1-due-before"><a href="/project1/">Project 1</a> due before</h3>

<p>Wednesday, October 8th 10am PT</p>

<h3 id="project-2project2-due-before"><a href="/project2/">Project 2</a> due before</h3>

<p>Wednesday, October 22 10am PT</p>

<h3 id="project-3project3-team-message-due-before"><a href="/project3/">Project 3</a> Team Message due before</h3>

<p>Wednesday, October 29 10am PT</p>

<h3 id="project-3project3-due-before"><a href="/project3/">Project 3</a> due before</h3>

<p>Monday, November 10 10am PT</p>

<h3 id="project-4-and-5-team-message-due-before">Project 4 and 5 Team Message due before</h3>

<p>Monday, November 17 10am PT</p>

<h3 id="project-4project4-due-before"><a href="/project4/">Project 4</a> due before</h3>

<p>Monday, November 24 10am PT</p>

<h3 id="project-5project5-intermediate-peer-feedback-score-due-before"><a href="/project5">Project 5</a> intermediate peer feedback score due before</h3>

<p>Monday, December 1st 10am PT</p>

<h3 id="project-5project5-report-due-before"><a href="/project5">Project 5</a> report due before</h3>

<p>Friday, December 12 2pm PT</p>

<h3 id="project-5project-final-peer-score-message-due-before"><a href="/project">Project 5</a> final peer score message due before</h3>

<p>Friday, December 12 5pm PT</p>

<h2 id="class-resources">Class Resources</h2>

<p><a href="https://piazza.com/ucsb/fall2025/cs291a">Piazza</a>: Use to receive class announcements, ask and
answer questions, and to communicate with instructor. Access code is available
in Google Drive and will be shared in the first class.</p>

<p><a href="https://github.com/scalableinternetservices">GitHub</a>: Contains content for
this site. Additionally all student projects will live here.</p>

<h2 id="textbooks">Textbooks</h2>

<p><a href="https://www.amazon.com/High-Performance-Browser-Networking-performance/dp/1449344763">High Performance Browser Networking</a><br />
ISBN: 9781449344764<br />
<em><a href="https://hpbn.co/">Available online</a>.</em><br />
Note: The online version is slightly more up-to-date.</p>

<p><a href="https://www.railstutorial.org/book">The Ruby On Rails Tutorial</a><br />
<!-- _[Complete 3rd edition available online](https://3rd-edition.railstutorial.org/book)_   -->
Optional
Note: This book is only useful once we get to the primary project.</p>

</div>

        </div>
        <div class="col-md-9">
          <h1 id="project-5-enhanced-help-desk-application">Project 5: Enhanced Help Desk Application</h1>

<p>Project 5 builds on all your projects so far.  This project will have 2 parts and will be due at the end of finals week.</p>

<h2 id="part-1">Part 1</h2>

<p>In part 1 of this project you will work with your team to improve the chat application by adding:</p>
<ul>
  <li>Auto assignment of newly created conversations to an expert</li>
  <li>Auto responsd to some questions based on the assinged expertâ€™s FAQ</li>
  <li>Provide a summary of a conversation in the conversation list view</li>
</ul>

<p>These features will be implemented using calls to a Language Model (LLM).</p>

<p>At the completion of Part 1, your team should re-run the load tests run for project 4 and discuss the
results as a team.  At this point you should be comparing the results from before LLM features were
added with the new test results and preparing the first section of your final report.  In this section of the report you will describe:</p>

<ul>
  <li>Initial load testing results from project 4 - (Before adding LLM features)</li>
  <li>Initial LLM feature implementation
    <ul>
      <li>Describe how the initial LLM features were implemented in step 1</li>
    </ul>
  </li>
  <li>Load testing results after adding LLM features
    <ul>
      <li>Compare/contrast these results to those collected in project 4</li>
      <li>If the results are different, discuss any hypothesis for the difference</li>
    </ul>
  </li>
</ul>

<h2 id="part-2">Part 2</h2>

<p>Iteratively decide as a team on at least 3 changes to you application that you will make to improve the scalability of your application.  Before making the changes, document the reasoning for making these particular changes and make a hypothesis about how you expect the result of a subsequent load test will change from a previous test without the change in place.</p>

<p>Your team will then make changes to your application with the aim of improving the scalability of your application and re-run the load tests after each change.  For each change you should add a section to your team report describing:</p>

<ul>
  <li>What was the change you decided to test</li>
  <li>What supporting evidence did you have to test this change</li>
  <li>What was the hypothesis about how this change would impact the load test results</li>
  <li>What was the observed impact on the load test results</li>
  <li>Discuss what was learned from running the load test and how it changes or confirms your original hypothesis</li>
</ul>

<p>It is the goal to improve the scalability, but learning from something that does not improve the scalability can be equally valuable.  It is ok if your changes do not work, but you should have a good learning from those outcomes that can be discussed.</p>

<p>Each change should be tested in isolation so it can be determined what itâ€™s impact is in isolation.
This doesnâ€™t mean that you canâ€™t test the impact of multiple changes together.
For example: If you have BASELINE load test, CHANGE_A, CHANGE_B, and CHANGE_C, it would be ok to</p>
<ul>
  <li>make CHANGE_A</li>
  <li>test CHANGE_A</li>
  <li>decide CHANGE_A was a success compared to the BASELINE test done before CHANGE_A</li>
  <li>merge CHANGE_A</li>
  <li>make CHANGE_B on top of the changes merged for CHANGE_A</li>
  <li>test CHANGE_B</li>
  <li>evaluate the results of testing CHANGE_A and CHANGE_B vs the test with just CHANGE_B</li>
  <li>â€¦ continue on to merge CHANGE_B and test CHANGE_C in the same way</li>
</ul>

<p>However, it would not be appropraite to evaluate a test of CHANGE_A, CHANGE_B togeher against the BASELINE test result in isolation.</p>

<p>It would also be ok to:</p>
<ul>
  <li>make CHANGE_A</li>
  <li>load test CHANGE_A</li>
  <li>compare load test of CHANGE_A against the BASELINE</li>
  <li>without merging CHANGE_A, make CHANGE_B on a differen branch</li>
  <li>load test CHANGE_B</li>
  <li>compare load test of CHANGE_B against the BASELINE</li>
  <li>â€¦</li>
</ul>

<p>If you choose to test the changes in isolation, you should do a final round of hypothesizing about what the impact will be of combining the succeful changes into a final branch will be and then do a final load test with those changes combined and discuss the results in comparision to the hypothesis and load tests done in isolation for the kept changes.</p>

<h1 id="project-teams">Project Teams</h1>

<p>This team must be comleted as part of a team.  You should be using the same team as you had for project 4.</p>

<h2 id="learning-outcomes">Learning Outcomes</h2>

<ul>
  <li>Student can reason about load test results</li>
  <li>Student can use evidence from results to create a hypotesis about a change to improve scalability</li>
  <li>Student can implement various scalability exeperiments</li>
  <li>Student can use load testing to evaluate the success of an experiment</li>
</ul>

<h2 id="project-submission">Project Submission</h2>

<ul>
  <li>Submission link will be posted at start of quarter</li>
</ul>

<h2 id="what-you-will-turn-in">What you will turn in</h2>

<ul>
  <li><strong>Github Repo</strong>: Containing your final project including LLM feature additions and changes to improve scalability.
    <ul>
      <li>A merged Pull Request that implements the LLM features</li>
      <li>A Pull Request (either merged or closed) for each scalability change discussed in the report</li>
    </ul>
  </li>
  <li><strong>Report</strong>: A report as described above.  Make sure to read the full project description to get an undersaning of what is expected in the report.</li>
</ul>

<h2 id="instructions-for-using-an-llm-in-your-application">Instructions for using an LLM in your application</h2>

<h3 id="setup-your-project">Setup your project</h3>

<p>Add the following gem to your Gemfile, then run <code class="language-plaintext highlighter-rouge">bundle install</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem "aws-sdk-bedrockruntime"
</code></pre></div></div>

<p>Add this file to you application in app/models/current.rb</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Current &lt; ActiveSupport::CurrentAttributes
  attribute :might_be_locust_request
end
</code></pre></div></div>

<p>Add the following code to app/controllers/application_controller.rb</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ApplicationController &lt; ActionController::API
  include ActionController::Cookies

  before_action :detect_locust_request

  private

  def detect_locust_request
    ua = request.user_agent.to_s

    if ua.include?("python-requests")
      Current.might_be_locust_request = true
    else
      Current.might_be_locust_request = false
    end
  end
end
</code></pre></div></div>

<p>Add the following code to app/services/bedrock_client.rb</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># frozen_string_literal: true

require "aws-sdk-bedrockruntime"

class BedrockClient
  # Simple wrapper for calling an LLM on Amazon Bedrock (Converse API).
  #
  # Usage:
  #
  #   client = BedrockClient.new(
  #     model_id: "anthropic.claude-3-5-haiku-20241022-v1:0",
  #     region: "us-west-2"
  #   )
  #
  #   response = client.call(
  #     system_prompt: "You are a helpful assistant.",
  #     user_prompt:   "Explain eventual consistency in simple terms."
  #   )
  #
  #   puts response[:output_text]
  #
  def initialize(model_id:, region: ENV["AWS_REGION"] || "us-west-2")
    @model_id = model_id
    @client   = Aws::BedrockRuntime::Client.new(region: region)
  end

  # Calls the LLM with the given system and user prompts.
  #
  # Params:
  # - system_prompt: String
  # - user_prompt:   String
  # - max_tokens:    Integer (optional)
  # - temperature:   Float   (optional)
  #
  # Returns a Hash like:
  # {
  #   output_text: "model response...",
  #   raw_response: &lt;Aws::BedrockRuntime::Types::ConverseResponse&gt;
  # }
  #
  def call(system_prompt:, user_prompt:, max_tokens: 1024, temperature: 0.7)

    if should_fake_llm_call?
      sleep(rand(0.8..3.5)) # Simulate a delay
      return {
        output_text: "This is a fake response from the LLM.",
        raw_response: nil
      }
    end

    response = @client.converse(
      model_id: @model_id,
      messages: [
        {
          role: "user",
          content: [
            { text: user_prompt }
          ]
        }
      ],
      system: [
        {
          text: system_prompt
        }
      ],
      inference_config: {
        max_tokens: max_tokens,
        temperature: temperature
      }
    )

    output_text = extract_text_from_converse_response(response)

    {
      output_text: output_text,
      raw_response: response
    }
  rescue Aws::BedrockRuntime::Errors::ServiceError =&gt; e
    # You can customize error handling however you like.
    raise "Bedrock LLM call failed: #{e.message}"
  end

  private

  def should_fake_llm_call?
    !(ENV["ALLOW_BEDROCK_CALL"] == "true") or Current.might_be_locust_request
  end

  # Converse can return multiple content blocks; weâ€™ll just join all text.
  def extract_text_from_converse_response(response)
    return "" unless response&amp;.output&amp;.message&amp;.content

    response.output.message.content
            .select { |c| c.respond_to?(:text) &amp;&amp; c.text }
            .map(&amp;:text)
            .join("\n")
  end
end
</code></pre></div></div>

<h3 id="instructions-for-local-development">Instructions for local development</h3>

<p><strong>KEEP THESE SECURE</strong></p>

<p>To use this this in local development, you will need to setup the AWS credentials in your localmachine.
To do this copy the ~/.aws/credentials file from the jump box to your localhost and put them in the same
location</p>

<p><strong>DO NOT CHECK THESE VALUSE INTO GITHUB</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp project2backend@ec2.cs291.com:~/.aws/credentials ~/.aws/cs291_credentials
</code></pre></div></div>

<p>You will need to mount this as a volume in your docker compose to make the credentials work in local development</p>

<p>Add a new env var and volume to your web container in the docker compose to make the credentials available to the
app when running in your docker container</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
    environment:
        - AWS_SHARED_CREDENTIALS_FILE=/app/.aws/cs291_credentials
    volumes:
        - ${HOME}/.aws:/app/.aws:ro   # ðŸ‘ˆ mount your host AWS creds here
</code></pre></div></div>

<h3 id="instructions-for-using-the-llm-when-deployed-to-elastic-beanstalk">Instructions for using the LLM when deployed to Elastic Beanstalk</h3>

<p>Iâ€™ve added a few layers of protection to prevent calling the LLM in the load testing environment.</p>

<p>To be allowed access to call the LLM on bedrock from Elastic Beanstalk you will need to set the instance profile
to be used by your EC2 instances at the time you create your environment and set an ENV variable that will allow
the LLM to be called.  These protections are implmented in the BedrockClient shown above.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> eb create &lt;env_name_goes_here&gt; \
   --envvars "ALLOW_BEDROCK_CALL=true" \
   --profile eb-with-bedrock-ec2-profile \
   &lt;Other parameters normally used&gt;
</code></pre></div></div>

        </div>
      </div>
    </div>

    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <p class="copyright">
        &copy; 2014-2021 <a href="https://www.linkedin.com/in/bryceboe/">Dr. Bryce Boe</a>
        &copy; 2022 <a href="https://www.linkedin.com/in/nevenagolubovic/">Dr. Nevena Golubovic</a>
        &copy; 2023 <a href="https://www.linkedin.com/in/shyr-shea-chang-6426271b8/">Dr. Shyr-Shea Chang</a>
        &copy; 2025 <a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a>.
      </p>
    </div>
  </div>
</div>


  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  </body>

</html>