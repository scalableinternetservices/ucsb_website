<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Scalable Internet Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>

  <body>

        <div class="container-fluid">
      <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Scalable Internet Services</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/schedule/">Class Schedule</a></li>
              <li class="active"><a href="/project0/">Project 0</a></li>
              <li class="active"><a href="/project1/">Project 1</a></li>
              <li class="active"><a href="/project2/">Project 2</a></li>
              <li class="active"><a href="/project3/">Project 3</a></li>
              <li class="active"><a href="/project/">Primary Project</a></li></ul>
          </div>
        </div>
      </div>
    </div>


    <div class="container container-left">
      <div class="row">
        <div class="col-md-3">
          <div class="sidebar">
  <h1 id="course-info">Course Info</h1>

<ul>
  <li>Course Number: CS291A</li>
  <li>Quarter: Fall 2024</li>
</ul>

<h2 id="instructor">Instructor</h2>

<ul>
  <li><a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a></li>
  <li><a href="mailto:zach_walker@ucsb.edu">email</a></li>
</ul>

<h2 id="ucsb-ta">UCSB TA</h2>

<ul>
  <li>TBD</li>
</ul>

<h2 id="appfolio-ta">Appfolio TA</h2>

<ul>
  <li>Maximilian Medearis</li>
  <li><a href="mailto:maximilian.medearis@appfolio.com">email</a></li>
</ul>

<p>Please use <a href="https://piazza.com/ucsb/fall2024/cs291a">Piazza</a> for class-related correspondance.</p>

<h2 id="dates">Dates</h2>

<h3 id="classes">Classes</h3>

<ul>
  <li>Tues and Thurs</li>
  <li>9:00am – 10:50am PT</li>
  <li>Phelps 3526</li>
</ul>

<h3 id="office-hours">Office Hours</h3>

<!-- - TBD

In-person

- Tuesday 8am -- 9am, Phelps 3526
- Thursday 8am -- 9am, Phelps 3526 -->

<p>Virtual</p>

<ul>
  <li>Tuesday 4 – 5pm, link in <a href="https://piazza.com/ucsb/fall2024/cs291a">Piazza</a></li>
  <li>Friday 4 – 5pm, link in <a href="https://piazza.com/ucsb/fall2024/cs291a">Piazza</a></li>
</ul>

<h3 id="initial-tasks-due-before">Initial tasks due before</h3>

<p>Monday, September 30 2pm PT</p>

<ul>
  <li>Complete the <a href="https://forms.gle/ypmAEJnCnS4EHgpW6">introduction survey</a></li>
  <li>Join the class on <a href="https://piazza.com/ucsb/fall2024/cs291a">Piazza</a></li>
</ul>

<!-- - Enroll in [AWS Educate](https://www.awseducate.com/Registration?apptype=student&courseview=true) -->

<h3 id="project-0project0-due-before"><a href="/project0/">Project 0</a> due before</h3>

<p>Monday, October 7 2pm PT</p>

<h3 id="project-1project1-due-before"><a href="/project1/">Project 1</a> due before</h3>

<p>Monday, October 14 2pm PT</p>

<h3 id="project-2project2-due-before"><a href="/project2/">Project 2</a> due before</h3>

<p>Monday, October 21 2pm PT</p>

<h3 id="project-3project3-team-message-due-before"><a href="/project3/">Project 3</a> Team Message due before</h3>

<p>Monday, October 21 2pm PT</p>

<h3 id="final-project-team-messageproject-due-before"><a href="/project">Final Project Team Message</a> due before</h3>

<p>Monday, November 4 2pm PT</p>

<h3 id="project-3project3-due-before"><a href="/project3/">Project 3</a> due before</h3>

<p>Monday, November 4 2pm PT</p>

<h3 id="projectprojectproposal-initial-peer-score-message-due-before"><a href="/project/#proposal">Project</a> initial peer score message due before</h3>

<p>Monday, November 27 2pm PT</p>

<h3 id="projectprojectreport-report-draft-for-feedback-due-before"><a href="/project/#report">Project</a> report draft for feedback due before</h3>

<p>Friday, December 6 2pm PT</p>

<h3 id="projectprojectproposal-final-peer-score-message-due-before"><a href="/project/#proposal">Project</a> final peer score message due before</h3>

<p>Friday, December 13 2pm PT</p>

<h3 id="projectprojectreport-report-due-before"><a href="/project/#report">Project</a> report due before</h3>

<p>Friday, December 13 2pm PT</p>

<h3 id="projectprojectvideo-video-due-before"><a href="/project/#video">Project</a> video due before</h3>

<p>Friday, December 13 2pm PT</p>

<h2 id="class-resources">Class Resources</h2>

<p><a href="https://piazza.com/ucsb/fall2024/cs291a">Piazza</a>: Use to receive class announcements, ask and
answer questions, and to communicate with instructor. Access code is available
in Google Drive and will be shared in the first class.</p>

<p><a href="https://github.com/scalableinternetservices">GitHub</a>: Contains content for
this site. Additionally all student projects will live here.</p>

<h2 id="textbooks">Textbooks</h2>

<p><a href="https://www.amazon.com/High-Performance-Browser-Networking-performance/dp/1449344763">High Performance Browser Networking</a><br />
ISBN: 9781449344764<br />
<em><a href="https://hpbn.co/">Available online</a>.</em><br />
Note: The online version is slightly more up-to-date.</p>

<p><a href="https://www.railstutorial.org/book">The Ruby On Rails Tutorial</a><br />
<!-- _[Complete 3rd edition available online](https://3rd-edition.railstutorial.org/book)_   -->
Optional
Note: This book is only useful once we get to the primary project.</p>

</div>

        </div>
        <div class="col-md-9">
          <h1 id="primary-project">Primary Project</h1>

<h2 id="objective">Objective</h2>

<p>The goal of the project is to gain hands-on experience in building and
deploying a scalable web service on the Internet. Using the latest web
technologies while learning how to tackle the scalability and fault-tolerance
concerns. This is a “learn by doing” course: the course project will form the
primary focus of the course with the lectures and discussion of research papers
providing background material. Each project will be conducted in an agile team
where students will build their own scalable, redundant site using
fundamental web technologies and the Ruby on Rails framework.</p>

<h2 id="resources">Resources</h2>

<p>Throughout the project, you might find it helpful to go through a ruby on rails
tutorial. The Ruby on Rails Tutorial (see sidebar) is an amazing resource.
Rail’s own tutorial is quite good as well:
<a href="https://guides.rubyonrails.org/getting_started.html">Getting Started with Rails</a></p>

<h2 id="submissions">Submissions</h2>

<ul>
  <li>
    <p><a href="https://forms.gle/2X8Po3KNVBvRqFGZ8">Team message</a></p>
  </li>
  <li>
    <p><a href="https://forms.gle/jjHBnisnaxhg3kEJ7">Mid Project Peer Review</a></p>
  </li>
  <li>
    <p><a href="https://forms.gle/GoSHQ74jxN5oP3Xu7">Final Peer Review</a></p>
  </li>
</ul>

<h2 id="deliverables">Deliverables</h2>

<h3 id="report">Report</h3>

<p>Submit a report describing your project, and your data-driven approach to load
testing. Consider answering the following questions:</p>

<ul>
  <li>What bottlenecks did you encounter along the way, and how did you address
them?</li>
  <li>What’s the optimal $ cost per number of users your web service supports?</li>
  <li>What design or functionality tradeoffs did you have to make in order to
support additional load?</li>
</ul>

<h4 id="stellar-report-examples">Stellar Report Examples</h4>

<ul>
  <li><a href="/report_samples/gaucho_book.pdf">Gaucho Book</a></li>
  <li><a href="/report_samples/whatever_chat.pdf">Whatever Chat</a></li>
</ul>

<h3 id="video">Video</h3>

<p>Record a video presentation of your final project to share with the class.
The video must be under 10 minutes in duration.</p>

<p>The video should emphasize your key features of your application.</p>

<h2 id="project-sprint-schedule">Project Sprint Schedule</h2>

<p>All sprints end and begin with each week’s lab session, except for the last
sprint which does not have an ending lab session.</p>

<p>At the end of each sprint you will:</p>

<ul>
  <li>Ensure all your completed stories are integrated on your main branch.</li>
  <li>Deploy your project using Elastic Beanstalk.</li>
  <li>Demo your deployed version and share the newly created features.</li>
  <li>Share any new load testing results.</li>
</ul>

<h3 id="sprint-1-week-6">Sprint 1: Week 6</h3>

<ul>
  <li>Form your team.
    <ul>
      <li>Decide on a team name</li>
      <li>One person on the team, submits Google form with:
        <ul>
          <li>Your team name</li>
          <li>The name, and GitHub username of all the team members</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Get access to your GitHub repository</li>
  <li>Get a new set of AWS credentials specific to your team.</li>
  <li>Deploy your initial rails code to Elastic Beanstalk.</li>
  <li>Complete <code class="language-plaintext highlighter-rouge">N</code> user stories, where <code class="language-plaintext highlighter-rouge">N</code> is the number of people on your team.</li>
</ul>

<h3 id="sprint-2-week-7">Sprint 2: Week 7</h3>

<ul>
  <li>Write a tsung load test encompassing your existing features.
    <ul>
      <li>Ensure that when it is run, there are no 4XX or 5XX level HTTP status
codes.</li>
    </ul>
  </li>
</ul>

<h3 id="sprints-345-weeks-8910">Sprints 3,4,5: Weeks 8,9,10</h3>

<ul>
  <li>Iterate between load testing, finding the bottlenecks, and addressing them
with techniques we discuss in the class</li>
</ul>

<h3 id="sprint-5-week-10">Sprint 5: Week 10+</h3>

<ul>
  <li>Complete the <a href="#report">project report</a></li>
  <li>Create <a href="#video">project presentation video</a></li>
  <li>Submit <a href="https://forms.gle/GoSHQ74jxN5oP3Xu7">peer_review</a></li>
</ul>

<hr />

<h2 id="creating-a-new-rails-application-using-docker">Creating a New Rails Application Using Docker</h2>

<p>Assuming you have docker installed locally, follow the steps below to create a
new rails project using docker.</p>

<h3 id="create-the-rails-project">Create the rails project</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>TEAMNAME
<span class="nb">cd </span>TEAMNAME
</code></pre></div></div>

<p>Assuming you have rails &gt;=7.1.2 installed on your system:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new <span class="nb">.</span> <span class="nt">--force</span> <span class="nt">--database</span><span class="o">=</span>postgresql <span class="nt">--skip-action-cable</span> <span class="nt">--skip-turbolinks</span> <span class="nt">--skip-jbuilder</span> <span class="nt">--skip-system-test</span>
</code></pre></div></div>

<p>This should generate a Dockerfile, Gemfile and Gemfile.lock in addition to a
standard rails project.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>docker-compose.yml
</code></pre></div></div>

<p>Now you should have the Dockerfile, docker-compose.yml, Gemfile and Gemfile.lock
files at the root of your project. (You can tough the files if they were not
created automatically)</p>

<p>Copy the following contents into <code class="language-plaintext highlighter-rouge">Dockerfile</code> (replace all content):</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax = docker/dockerfile:1</span>

<span class="c"># Make sure RUBY_VERSION matches the Ruby version in .ruby-version and Gemfile</span>
<span class="k">ARG</span><span class="s"> RUBY_VERSION=3.2.2</span>
<span class="k">FROM</span><span class="s"> ruby:$RUBY_VERSION</span>

<span class="c"># throw errors if Gemfile has been modified since Gemfile.lock</span>
<span class="k">RUN </span>bundle config <span class="nt">--global</span> frozen 1

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install packages needed to build gems</span>
<span class="k">RUN </span>apt-get update <span class="nt">-qq</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get <span class="nb">install</span> <span class="nt">--no-install-recommends</span> <span class="nt">-y</span> build-essential git libpq-dev libvips pkg-config

<span class="k">RUN </span>curl <span class="nt">-sS</span> https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add <span class="se">\
</span>  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"deb https://dl.yarnpkg.com/debian/ stable main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/yarn.list <span class="se">\
</span>  <span class="o">&amp;&amp;</span> apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> nodejs yarn <span class="nt">--no-install-recommends</span>

<span class="c"># Install application gems</span>
<span class="k">COPY</span><span class="s"> Gemfile Gemfile.lock ./</span>
<span class="k">RUN </span>bundle <span class="nb">install</span>

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Start the server by default, this can be overwritten at runtime</span>
<span class="c"># EXPOSE 3000</span>
<span class="k">CMD</span><span class="s"> ["/bin/bash"]</span>
</code></pre></div></div>

<p>Copy the following contents into <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./tmp/db:/var/lib/postgresql/data</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">bash -c "rm -f tmp/pids/server.pid &amp;&amp; bundle exec rails s -p 3000 -b '0.0.0.0'"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/app:delegated</span>
</code></pre></div></div>

<p>Replace the contents of the <code class="language-plaintext highlighter-rouge">Gemfile</code> with:</p>

<pre><code class="language-gem">source "https://rubygems.org"

ruby "3.2.2"

gem "rails", "~&gt; 7.1.2"

gem "sprockets-rails"

gem "pg", "~&gt; 1.1.0"

# Check the latest supported [https://docs.aws.amazon.com/elasticbeanstalk/latest/platforms/platforms-supported.html#platforms-supported.ruby]
gem "puma", "&gt;= 5.0"

gem "importmap-rails"

gem "turbo-rails"

gem "stimulus-rails"

gem "tzinfo-data", platforms: %i[ windows jruby ]

gem "bootsnap", require: false

group :development, :test do
  gem "debug", platforms: %i[ mri windows ]
end

group :development do
  gem "web-console"
end
</code></pre>

<p>Every time you make changes to the <code class="language-plaintext highlighter-rouge">Gemfile</code>, you will need to create a new
<code class="language-plaintext highlighter-rouge">Gemfile.lock</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">"</span>:/app <span class="nt">-w</span> /app ruby:3.2.2 bundle <span class="nb">install</span>
</code></pre></div></div>

<p>Initialize your git repository and make an initial commit:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"Prepare the project directory"</span>
</code></pre></div></div>

<h3 id="build-the-rails-project">Build the rails project</h3>

<p>If on M1 MAC run the following command:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">DOCKER_DEFAULT_PLATFORM</span><span class="o">=</span>linux/amd64
</code></pre></div></div>

<p>Build the <code class="language-plaintext highlighter-rouge">web</code> container image using <code class="language-plaintext highlighter-rouge">docker-compose</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose build web
</code></pre></div></div>

<h3 id="configure-the-project-to-talk-to-the-database-container">Configure the project to talk to the database container</h3>

<p>Add the following to lines to the <code class="language-plaintext highlighter-rouge">default</code> section of <code class="language-plaintext highlighter-rouge">config/database.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">host</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("PGHOST") { "db" } %&gt;</span>
<span class="na">password</span><span class="pi">:</span> <span class="s">postgres</span>
<span class="na">username</span><span class="pi">:</span> <span class="s">postgres</span>
</code></pre></div></div>

<p>Make a commit:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"Configure the project to talk to the database container"</span>
</code></pre></div></div>

<h3 id="create-the-development-and-test-databases">Create the development and test databases</h3>

<p>First start up the database container:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">--detach</span> db
</code></pre></div></div>

<p>Then verify that the container is running:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose ps
</code></pre></div></div>

<p>The output should look like:</p>

<pre><code class="language-txt">NAME               COMMAND                  SERVICE             STATUS              PORTS
TEAMNAME-db-1      "docker-entrypoint.s…"   db                  running             5432/tcp
</code></pre>

<p>Run the following to create and the database:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run web rails db:create
</code></pre></div></div>

<p>Run the following to create and commit the empty schema file.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run web rails db:migrate
git add db/schema.rb
git commit <span class="nt">-m</span> <span class="s2">"Add empty schema file"</span>
</code></pre></div></div>

<h3 id="ensure-dependencies-are-up-to-date">Ensure dependencies are up-to-date</h3>

<p>Periodically run the following two commands to ensure your ruby and node
dependencies are up to date:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run web bundle <span class="nb">install
</span>docker-compose run web yarn <span class="nb">install</span>
</code></pre></div></div>

<p>If your project has outstanding changes as shown via <code class="language-plaintext highlighter-rouge">git status</code>, consider
making a commit at this time.</p>

<h3 id="start-the-development-server">Start the development server</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up
</code></pre></div></div>

<p>At this point you <em>should</em> be able to access the “Rails” page
via <a href="http://localhost:3000">http://localhost:3000</a>.</p>

<hr />

<h2 id="pushing-to-github-and-setting-up-actions">Pushing to GitHub and Setting Up Actions</h2>

<p>If you haven’t already, add GitHub as a remote:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote add origin git@github.com:scalableinternetservices/TEAMNAME.git
</code></pre></div></div>

<p>If this is your first time pushing to GitHub, then run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch <span class="nt">-M</span> main
git push <span class="nt">-u</span> origin HEAD
</code></pre></div></div>

<p>Otherwise, you can simply run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push
</code></pre></div></div>

<h3 id="github-actions">GitHub Actions</h3>

<p>To trigger automated test runs everytime you push to main, or create a pull
request, or push an update to a branch associated with a pull request do the
following.</p>

<p>Run the following:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> .github/workflows
<span class="nb">touch</span> .github/workflows/ruby.yml
</code></pre></div></div>

<p>Then copy the following contents into the file <code class="language-plaintext highlighter-rouge">.github/workflows/ruby.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Ruby</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">services</span><span class="pi">:</span>
      <span class="na">postgres</span><span class="pi">:</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">postgres</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">5432:5432</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install PostgreSQL client</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">sudo apt-get -yqq install libpq-dev</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Ruby</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">bundler-cache</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up yarn</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">yarn install --pure-lockfile</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Prepare database</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">PGHOST</span><span class="pi">:</span> <span class="s">localhost</span>
          <span class="na">RAILS_ENV</span><span class="pi">:</span> <span class="s">test</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">bin/rails db:setup</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">PGHOST</span><span class="pi">:</span> <span class="s">localhost</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">bin/rails test</span>
</code></pre></div></div>

<p>Add, commit, and push these changes:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"Configure GitHub actions"</span>
git push
</code></pre></div></div>

<h2 id="deploying-to-elastic-beanstalk">Deploying to Elastic Beanstalk</h2>

<p>At this point you should have a Rails project that you can successfully run in
development locally using Docker. In the following steps we’ll make the
necessary adjustments to configure the application for Amazon’s Elastic
Beanstalk, and then deploy it.</p>

<h3 id="configure-the-production-database">Configure the production database</h3>

<p>Update the lines in the <code class="language-plaintext highlighter-rouge">production</code> section of <code class="language-plaintext highlighter-rouge">config/database.yml</code> to include:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">database</span><span class="pi">:</span> <span class="s">&lt;%= ENV['RDS_DB_NAME'] %&gt;</span>
<span class="na">host</span><span class="pi">:</span> <span class="s">&lt;%= ENV['RDS_HOSTNAME'] %&gt;</span>
<span class="na">password</span><span class="pi">:</span> <span class="s">&lt;%= ENV['RDS_PASSWORD'] %&gt;</span>
<span class="na">port</span><span class="pi">:</span> <span class="s">&lt;%= ENV['RDS_PORT'] %&gt;</span>
<span class="na">username</span><span class="pi">:</span> <span class="s">&lt;%= ENV['RDS_USERNAME'] %&gt;</span>
</code></pre></div></div>

<h3 id="add-ebextensions-to-install-nodejs-and-yarn-on-each-application-server-instance">Add ebextensions to install nodejs and yarn on each application server instance</h3>

<p>Create the directory and file</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> .ebextensions
<span class="nb">touch</span> .ebextensions/01_install_dependencies.config
<span class="nb">touch</span> .ebextensions/10_nginx_add_packs.config
</code></pre></div></div>

<p>Copy the following contents into <code class="language-plaintext highlighter-rouge">.ebextensions/01_install_dependencies.config</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">commands</span><span class="pi">:</span>
  <span class="na">install_nodejs</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">curl --silent --location https://rpm.nodesource.com/setup_14.x | bash -</span>
      <span class="s">yum install -y nodejs</span>
  <span class="na">install_yarn</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">curl --silent --location https://dl.yarnpkg.com/rpm/yarn.repo | tee /etc/yum.repos.d/yarn.repo</span>
      <span class="s">yum install -y yarn</span>
</code></pre></div></div>

<p>Copy the following contents into <code class="language-plaintext highlighter-rouge">.ebextensions/10_nginx_add_packs.config</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">commands</span><span class="pi">:</span>
  <span class="na">add_packs_location_to_nginx</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">grep packs /opt/elasticbeanstalk/config/private/nginx/webapp.conf || sed -i '$a\\nlocation /packs {\n    alias /var/app/current/public/packs;\n    gzip_static on;\n    gzip on;\n    expires max;\n    add_header Cache-Control public;\n}' /opt/elasticbeanstalk/config/private/nginx/webapp.conf</span>
</code></pre></div></div>

<h3 id="configure-the-profile">Configure the Profile</h3>

<p>Inform elasticbeanstalk to use your chosen version of puma.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>Procfile
</code></pre></div></div>

<p>Copy the following contents in <code class="language-plaintext highlighter-rouge">Procfile</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">web</span><span class="pi">:</span> <span class="s">bundle exec puma -C /opt/elasticbeanstalk/config/private/pumaconf.rb</span>
</code></pre></div></div>

<h3 id="commit-and-push-the-changes">Commit and push the changes</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"Prepare the application to deploy to Amazon's Elastic Beanstalk"</span>
git push
</code></pre></div></div>

<h3 id="ssh-to-ec2cs291com-and-clone-your-repository">SSH to ec2.cs291.com and clone your repository</h3>

<p>In order to most easily create an elastic beanstalk deployment, we need to SSH
into <code class="language-plaintext highlighter-rouge">ec2.cs291.com</code>. You should have received the file <code class="language-plaintext highlighter-rouge">TEAMNAME.pem</code> via your
UCSB Google Drive. Assuming that file is in your downloads folder run the
following:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> ~/Downloads/TEAMNAME.pem TEAMNAME@ec2.cs291.com
</code></pre></div></div>

<p>Once logged in, setup your ssh keys to access GitHub repo.
Generate the key pair:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"your_email@example.com"</span>
</code></pre></div></div>

<p>Then upload the key pair with read-only permissions to GitHub.</p>

<p>For more info see <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">Adding a new SSH key to your GitHub account
</a></p>

<p>After uploading your public key to GitHub, clone your repository using SSH
(this will be a read-only version of the project):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:scalableinternetservices/TEAMNAME.git
</code></pre></div></div>

<h3 id="configure-elastic-beanstalk">Configure Elastic Beanstalk</h3>

<p>For each copy of your repository, you’ll need to do the following only once:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>TEAMNAME
eb init <span class="nt">--keyname</span> <span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span> <span class="se">\</span>
  <span class="nt">--platform</span> <span class="s2">"64bit Amazon Linux 2023 v4.0.1 running Ruby 3.2"</span> <span class="se">\</span>
  <span class="nt">--region</span> us-west-2 TEAMNAME
</code></pre></div></div>

<h3 id="create-a-deployment-using-the-minimum-necessary-resources">Create a deployment using the minimum necessary resources</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eb create <span class="nt">--envvars</span> <span class="nv">SECRET_KEY_BASE</span><span class="o">=</span>BADSECRET <span class="se">\</span>
  <span class="nt">-db</span>.engine postgres <span class="nt">-db</span>.i db.t3.micro <span class="nt">-db</span>.user u <span class="se">\</span>
  <span class="nt">-i</span> t3.micro <span class="nt">--single</span> YOURNAME
</code></pre></div></div>

<p>Enter a database password at the prompt (twice) and then take a break as
creating a deployment will take about ten minutes (the database is slow to
create).</p>

<h3 id="verify-the-deployment">Verify the deployment</h3>

<p>Run <code class="language-plaintext highlighter-rouge">eb status</code> to see the state of your deployment. The output should look
something like the following:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Environment details for</span><span class="pi">:</span> <span class="s">YOURNAME</span>
  <span class="s">Application name</span><span class="err">:</span> <span class="s">TEAMNAME</span>
  <span class="s">Region</span><span class="err">:</span> <span class="s">us-west-2</span>
  <span class="s">Deployed Version</span><span class="err">:</span> <span class="s">app-f1ab-221021_194424258658</span>
  <span class="s">Environment ID</span><span class="err">:</span> <span class="s">e-7fm2cwv55t</span>
  <span class="s">Platform</span><span class="err">:</span> <span class="s">arn:aws:elasticbeanstalk:us-west-2::platform/Ruby 3.0 running on 64bit Amazon Linux 2/3.5.0</span>
  <span class="s">Tier</span><span class="err">:</span> <span class="s">WebServer-Standard-1.0</span>
  <span class="s">CNAME</span><span class="err">:</span> <span class="s">TEAMNAME.eba-6k3duymc.us-west-2.elasticbeanstalk.com</span>
  <span class="s">Updated</span><span class="err">:</span> <span class="s">2022-10-21 19:45:40.487000+00:00</span>
  <span class="s">Status</span><span class="err">:</span> <span class="s">Ready</span>
  <span class="s">Health</span><span class="err">:</span> <span class="s">Green</span>
</code></pre></div></div>

<p>The two most important parts are that <code class="language-plaintext highlighter-rouge">Status</code> is <code class="language-plaintext highlighter-rouge">Ready</code>, and <code class="language-plaintext highlighter-rouge">Health</code> is
<code class="language-plaintext highlighter-rouge">Green</code>. If not consult the logs <code class="language-plaintext highlighter-rouge">eb logs</code>.</p>

<p>To test if the deployment is successful copy the CNAME, and paste it into your
browser:
<a href="http://YOURNAME.yxhf954iam.us-west-2.elasticbeanstalk.com">http://YOURNAME.yxhf954iam.us-west-2.elasticbeanstalk.com</a></p>

<p>If you get a page stating <code class="language-plaintext highlighter-rouge">The page you were looking for doesn't exist.</code>, that
likely means things are working, and you have yet to set up a <code class="language-plaintext highlighter-rouge">root_route</code> on
your site (the “Yay! You’re on Rails!” doesn’t show up in <code class="language-plaintext highlighter-rouge">production</code> mode).</p>

<hr />

<h2 id="updating-the-application">Updating the application</h2>

<p>After making changes and verifying they work with locally, push your changes to
GitHub, pull them on <code class="language-plaintext highlighter-rouge">ec2.cs291.com</code> and then update your deployment via:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eb deploy
</code></pre></div></div>

<p><strong>Note</strong>: Only commited changes are pushed on deployment, so ensure <code class="language-plaintext highlighter-rouge">git
status</code> is clean. (You can run <code class="language-plaintext highlighter-rouge">eb deploy --staged</code> to include staged files,
but it’s preferrable to deploy code that has been pushed to GitHub.</p>

<hr />

<h2 id="working-with-deployments">Working with deployments</h2>

<h2 id="viewing-logs">Viewing Logs</h2>

<p>To view the logs run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eb logs | less <span class="nt">-R</span>
</code></pre></div></div>

<h2 id="ssh-into-an-application-server">SSH into an application server</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eb ssh <span class="nt">-i</span> <span class="s2">"ssh -i ~/</span><span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span><span class="s2">.pem"</span>
</code></pre></div></div>

<h3 id="cleaning-up">Cleaning Up</h3>

<p>When you know you’re done, clean up your deployment:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eb terminate
</code></pre></div></div>

<p><strong>Note</strong>: Deployments will automatically be cleaned up ~110 minutes after their
last update.</p>

<hr />

<h2 id="project-ideas">Project Ideas</h2>

<p>Please select from one of the following project ideas. You are free to modify
them as you wish, and can even come up with another project idea, but the
complexity must remain the same.</p>

<p>Please note all the user stories start off with unauthenticated users. That’s
because you want to deliver functionality first. Implementing authentication
first does not provide any value, if that authentication has no features behind
it. Complete a set of unauthenticated stories first, prior to introducing
authentication.</p>

<h3 id="a-social-network">A Social Network</h3>

<p>Minimum necessary models:</p>

<ul>
  <li>Post</li>
  <li>Comment (on Post)</li>
  <li>Profile</li>
  <li>Message (profile to profile)</li>
</ul>

<p>Initial user stories:</p>

<ol>
  <li>
    <p>As an unauthenticated user I can make a post so that I can share whatever
cool things I want.</p>
  </li>
  <li>
    <p>As an unauthenticated user I can view all the posts on the front page in
descending order so that I can see what new things people are sharing.</p>
  </li>
  <li>
    <p>As an unauthenticated user, I can comment on a post so that I can add
updates to existing content.</p>
  </li>
  <li>
    <p>As an authenticated user, my front page shows only posts made on my profile
so that I can see content specific to me.</p>
  </li>
  <li>
    <p>As as authenticated user, my posts and comments are attributable to me so
that others know what I’ve shared.</p>
  </li>
</ol>

<h3 id="an-online-store">An Online Store</h3>

<p>Minimum necessary models:</p>

<ul>
  <li>Item</li>
  <li>Order</li>
  <li>Rating (user to item)</li>
  <li>User</li>
</ul>

<p>Initial user stories:</p>

<ol>
  <li>
    <p>As an unauthenticated user I can list my item on the store so that I can
sell my products.</p>
  </li>
  <li>
    <p>As an unauthenticated user I can purchase an item from the store so that I
can obtain the things I desire.</p>
  </li>
  <li>
    <p>As an unauthenticated user I can view all the purchase histories so that I
can see what others have bought.</p>
  </li>
  <li>
    <p>As an unauthenticated user, I can rate an item that has been purchased so
that I can share my opinions of the item with others.</p>
  </li>
  <li>
    <p>As an authenticated user, only I can see my own orders in my order history
because I don’t want others to see what I’ve purchased.</p>
  </li>
</ol>

<h3 id="an-event-sharing-service">An Event Sharing Service</h3>

<p>Minimum necessary models:</p>

<ul>
  <li>Event</li>
  <li>RSVP</li>
  <li>Comment</li>
  <li>User</li>
  <li>Invite</li>
</ul>

<p>Initial user stories:</p>

<ol>
  <li>
    <p>As an unauthenticated user, I can create an event so that I can share with
others the details of the event I am hosting.</p>
  </li>
  <li>
    <p>As an unauthenticated user, I can comment on an event to share my enthusiasm
for said event.</p>
  </li>
  <li>
    <p>As an authenticated user, I can RSVP yes/no to events that I do [not] intend
to attend so that the host can better estimate how many people will show up.</p>
  </li>
  <li>
    <p>As an authenticated user, I can see the list of events that I have
previously attended so that I can recall my fond memories.</p>
  </li>
  <li>
    <p>As an event host, I can proactively invite users to my event, so that I can
help spread the word.</p>
  </li>
</ol>

        </div>
      </div>
    </div>

    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <p class="copyright">
        &copy; 2014-2021 <a href="https://www.linkedin.com/in/bryceboe/">Dr. Bryce Boe</a>
        &copy; 2022 <a href="https://www.linkedin.com/in/nevenagolubovic/">Dr. Nevena Golubovic</a>
        &copy; 2023 <a href="https://www.linkedin.com/in/shyr-shea-chang-6426271b8/">Dr. Shyr-Shea Chang</a>
        &copy; 2024 <a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a>.
      </p>
    </div>
  </div>
</div>


  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  </body>

</html>