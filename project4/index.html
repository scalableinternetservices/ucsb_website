<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Scalable Internet Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>

  <body>

        <div class="container-fluid">
      <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Scalable Internet Services</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/schedule/">Class Schedule</a></li>
              <li class="active"><a href="/project1/">Project 1</a></li>
              <li class="active"><a href="/project2/">Project 2</a></li>
              <li class="active"><a href="/project3/">Project 3</a></li>
              <li class="active"><a href="/project4/">Project 4</a></li></ul>
          </div>
        </div>
      </div>
    </div>


    <div class="container container-left">
      <div class="row">
        <div class="col-md-3">
          <div class="sidebar">
  <h1 id="course-info">Course Info</h1>

<ul>
  <li>Course Number: CS291A</li>
  <li>Quarter: Fall 2025</li>
</ul>

<h2 id="instructor">Instructor</h2>

<ul>
  <li><a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a></li>
  <li><a href="mailto:zach_walker@ucsb.edu">email</a></li>
</ul>

<!-- ## UCSB TA

- TBD

## Appfolio TA

- Maximilian Medearis
- [email](mailto:maximilian.medearis@appfolio.com)


Please use [Piazza](https://piazza.com/ucsb/fall2025/cs291a) for class-related correspondance.
 -->

<h2 id="dates">Dates</h2>

<h3 id="classes">Classes</h3>

<ul>
  <li>Mon and Wed</li>
  <li>1:00pm – 2:50am PT</li>
  <li>Phelps 2510</li>
</ul>

<h3 id="office-hours">Office Hours</h3>

<!-- - TBD

In-person

- Tuesday 8am -- 9am, Phelps 3526
- Thursday 8am -- 9am, Phelps 3526

Virtual

- Tuesday 4 -- 5pm, link in [Piazza](https://piazza.com/ucsb/fall2025/cs291a)
- Friday 4 -- 5pm, link in [Piazza](https://piazza.com/ucsb/fall2025/cs291a) -->

<h3 id="initial-tasks-due-before">Initial tasks due before</h3>

<p>Wednesday, Oct 1 12pm PT</p>

<ul>
  <li>Complete the <a href="https://forms.gle/TyxFWZnkW9qaqBhE7">introduction survey</a></li>
  <li>Join the class on <a href="https://piazza.com/ucsb/fall2025/cs291a">Piazza</a></li>
</ul>

<!-- - Enroll in [AWS Educate](https://www.awseducate.com/Registration?apptype=student&courseview=true) -->

<h3 id="project-1project1-due-before"><a href="/project1/">Project 1</a> due before</h3>

<p>Wednesday, October 8th 10am PT</p>

<h3 id="project-2project2-due-before"><a href="/project2/">Project 2</a> due before</h3>

<p>Wednesday, October 22 10am PT</p>

<h3 id="project-3project3-team-message-due-before"><a href="/project3/">Project 3</a> Team Message due before</h3>

<p>Wednesday, October 29 10am PT</p>

<h3 id="project-3project3-due-before"><a href="/project3/">Project 3</a> due before</h3>

<p>Monday, November 10 10am PT</p>

<h3 id="project-4-and-5-team-message-due-before">Project 4 and 5 Team Message due before</h3>

<p>Monday, November 17 10am PT</p>

<h3 id="project-4project4-due-before"><a href="/project4/">Project 4</a> due before</h3>

<p>Monday, November 24 10am PT</p>

<h2 id="class-resources">Class Resources</h2>

<p><a href="https://piazza.com/ucsb/fall2025/cs291a">Piazza</a>: Use to receive class announcements, ask and
answer questions, and to communicate with instructor. Access code is available
in Google Drive and will be shared in the first class.</p>

<p><a href="https://github.com/scalableinternetservices">GitHub</a>: Contains content for
this site. Additionally all student projects will live here.</p>

<h2 id="textbooks">Textbooks</h2>

<p><a href="https://www.amazon.com/High-Performance-Browser-Networking-performance/dp/1449344763">High Performance Browser Networking</a><br />
ISBN: 9781449344764<br />
<em><a href="https://hpbn.co/">Available online</a>.</em><br />
Note: The online version is slightly more up-to-date.</p>

<p><a href="https://www.railstutorial.org/book">The Ruby On Rails Tutorial</a><br />
<!-- _[Complete 3rd edition available online](https://3rd-edition.railstutorial.org/book)_   -->
Optional
Note: This book is only useful once we get to the primary project.</p>

</div>

        </div>
        <div class="col-md-9">
          <h1 id="project-4-vertical-and-horizontal-scaling-of-your-rails-backend">Project 4: Vertical and Horizontal Scaling of your Rails Backend</h1>

<p>This project builds upon Project 3.  You should now have the backend of the help desk
application implementd in Ruby on Rails.  So far we have run the rails backend on localhost
only.  Now, we will deploy your web applications to AWS and charachterize the performance
of your applications by load testing the application in a few different configurations.</p>

<h1 id="project-teams">Project Teams</h1>

<p>This project and project 5 must be completed as part of a team.
Teams must be formed by Monday November 17th and be composed of 4 or 5 people.
Have one person on your team send me a message with the following details:</p>
<ul>
  <li>Team Name</li>
  <li>Team Member Names</li>
</ul>

<h2 id="learning-outcomes">Learning Outcomes</h2>

<ul>
  <li>Student can delpoy a Ruby on Rails application to <a href="https://aws.amazon.com/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
  <li>Student can implement vertical scaling by modifying the AWS application instance size</li>
  <li>Student can implement vertical scaling by modifying the AWS database instance size</li>
  <li>Student can implement horizontal scaling by deploying multiple load balanced application instances</li>
  <li>Student can run write a load test using <a href="https://locust.io/">Locust</a></li>
  <li>Student can interpret the results of load tests</li>
</ul>

<h2 id="project-submission">Project Submission</h2>

<ul>
  <li>Submission link will be posted at start of quarter</li>
</ul>

<h2 id="whats-included">What’s Included</h2>

<ul>
  <li><strong>AWS Credentials</strong>: Credentials for accessing AWS services needed for deployment</li>
  <li><strong>Deployment Instructions</strong>: Directions for deploying your rails appilcation to elastic beanstalk</li>
  <li><strong>Example Locustfile</strong>: A basic example of a test file using Locust as a starting point</li>
  <li><strong>Scaled Infra Options to Test</strong>: - A set of scaling configurations to run your load test against</li>
</ul>

<h2 id="what-you-provide">What you provide</h2>

<ul>
  <li><strong>Rails Application</strong>: This should be a version of the rails backend from project 3</li>
  <li><strong>Locustfile</strong>: A load test created using Locust</li>
</ul>

<h2 id="what-you-will-turn-in">What you will turn in</h2>

<ul>
  <li><strong>Locustfile</strong>: The locustfile used for load testing your application</li>
  <li><strong>Load Testing Results</strong>: A document that including the following sections
    <ul>
      <li>Load Test - Describes the methodology of your load test. This should include descriptions of user personas, tasks performed by each user, rationale for weighting of user personas and tasks.  Also included should be the methodology used for increasing the load during the test.  Ex: 1 new user arriving every second up to 500 users…</li>
      <li>Load Test Results - For each deployment configuration, describe the configuration and the load testing results including plots and statistics.</li>
    </ul>
  </li>
</ul>

<h2 id="scaling-configurations-to-test">Scaling Configurations To Test</h2>

<ul>
  <li>Single Instance
    <ul>
      <li>1 Application Server: Instance Type m7g.medium</li>
      <li>1 Database Server: Instance Type db.m5.large</li>
    </ul>
  </li>
  <li>Vertical Scaling
    <ul>
      <li>1 Application Server: Instance Type m7g.large</li>
      <li>1 Database Server: Instance Type db.m5.large</li>
    </ul>
  </li>
  <li>Horizonal Scaling 1
    <ul>
      <li>4 Application Servers: Instance Type m7g.medium</li>
      <li>1 Database Server: Instance Type db.m5.large</li>
    </ul>
  </li>
  <li>Horizonal Scaling 2 w/ larger DB Instance
    <ul>
      <li>4 Application Servers: Instance Type m7g.medium</li>
      <li>1 Database Server: Instance Type db.m5.xlarge</li>
    </ul>
  </li>
</ul>

<h2 id="example-locustfile">Example Locustfile</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"""
Locust load test for chat-backend-rails application.

User personas:
1. New user registering for the first time (1 in every 10 users)
2. Polling user that checks for updates every 5 seconds
3. Active user that uses existing usernames to create conversations, post messages, and browse
"""

import random
import threading
from datetime import datetime
from locust import HttpUser, task, between


# Configuration
MAX_USERS = 10000

class UserNameGenerator:
    PRIME_NUMBERS = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]

    def __init__(self, max_users=MAX_USERS, seed=None, prime_number=None):
        self.seed = seed or random.randint(0, max_users)
        self.prime_number = prime_number or random.choice(self.PRIME_NUMBERS)
        self.current_index = -1
        self.max_users = max_users
    
    def generate_username(self):
        self.current_index += 1
        return f"user_{(self.seed + self.current_index * self.prime_number) % self.max_users}"


class UserStore:
    def __init__(self):
        self.used_usernames = {}
        self.username_lock = threading.Lock()

    def get_random_user(self):
        with self.username_lock:
            random_username = random.choice(list(self.used_usernames.keys()))
            return self.used_usernames[random_username]

    def store_user(self, username, auth_token, user_id):
        with self.username_lock:
            self.used_usernames[username] = {
                "username": username,
                "auth_token": auth_token,
                "user_id": user_id
            }
            return self.used_usernames[username]


user_store = UserStore()
user_name_generator = UserNameGenerator(max_users=MAX_USERS)

class ChatBackend():
    """
    Base class for all user personas.
    Provides common authentication and API interaction methods.
    """        
    
    def login(self, username, password):
        """Login an existing user."""
        response = self.client.post(
            "/auth/login",
            json={"username": username, "password": password},
            name="/auth/login"
        )
        if response.status_code == 200:
            data = response.json()
            return user_store.store_user(username, data.get("token"), data.get("user", {}).get("id"))
        return None
        
    def register(self, username, password):
        """TODO"""

    def check_conversation_updates(self, user):
        """Check for conversation updates."""
        params = {"userId": user.get("user_id")}
        if self.last_check_time:
            params["since"] = self.last_check_time.isoformat()
        
        response = self.client.get(
            "/api/conversations/updates",
            params=params,
            headers=auth_headers(user.get("auth_token")),
            name="/api/conversations/updates"
        )
        
        return response.status_code == 200
    
    def check_message_updates(self, user):
        """TODO"""
    
    def check_expert_queue_updates(self, user):
        """TODO"""
    

class IdleUser(HttpUser, ChatBackend):
    """
    Persona: A user that logs in and is idle but their browser polls for updates.
    Checks for message updates, conversation updates, and expert queue updates every 5 seconds.
    """
    weight = 10
    wait_time = between(5, 5)  # Check every 5 seconds

    def on_start(self):
        """Called when a simulated user starts."""
        self.last_check_time = None
        username = user_name_generator.generate_username()
        password = username
        self.user = self.login(username, password) or self.register(username, password)
        if not self.user:
            raise Exception(f"Failed to login or register user {username}")

    @task
    def poll_for_updates(self):
        """Poll for all types of updates."""
        # Check conversation updates
        self.check_conversation_updates(self.user)
        
        # Check message updates
        self.check_message_updates(self.user)
        
        # Check expert queue updates
        self.check_expert_queue_updates(self.user)
        
        # Update last check time
        self.last_check_time = datetime.utcnow()

</code></pre></div></div>

        </div>
      </div>
    </div>

    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <p class="copyright">
        &copy; 2014-2021 <a href="https://www.linkedin.com/in/bryceboe/">Dr. Bryce Boe</a>
        &copy; 2022 <a href="https://www.linkedin.com/in/nevenagolubovic/">Dr. Nevena Golubovic</a>
        &copy; 2023 <a href="https://www.linkedin.com/in/shyr-shea-chang-6426271b8/">Dr. Shyr-Shea Chang</a>
        &copy; 2025 <a href="https://www.linkedin.com/in/zachary-walker-6a219059/">Zach Walker</a>.
      </p>
    </div>
  </div>
</div>


  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  </body>

</html>